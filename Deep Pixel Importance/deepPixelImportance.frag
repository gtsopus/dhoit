//-----------------------------------------------------------------------------------------------
// Implementation of "Deep Hybrid Order-Independent Trasparency" adapted from S-Buffer method 
// as described in "Deep Hybrid Order-Independent Trasparency" by G. Tsopouridis A. A. Vasilakis 
// and Ioannis Fudos.
//-----------------------------------------------------------------------------------------------

layout(binding = 0, r32ui ) readonly uniform uimage2D image_counter;
layout(binding = 4, offset = 0) uniform atomic_uint total_counter;
layout(binding = 6, r32f ) uniform image2D image_importance;
layout(binding = 3, r32f) coherent uniform image2D  zMinMax;
layout(binding = 2, rgba32f) coherent uniform image2D  featureTex;
layout(binding = 1, r32ui) coherent uniform image2D  nearest_featureTex;

layout (binding = 7, std140) uniform shader_data
{ 
  float weights[8192];
};

float weights1[12][12] = {{0.28498566150665283,-0.07768642902374268,0.18330812454223633,0.359954833984375,0.340651273727417,0.19111943244934082,0.09672021865844727,0.29937243461608887,0.35372769832611084,0.34810400009155273,-0.2639608383178711,0.46530044078826904},{-0.3798008859157562,-0.029986584559082985,0.010632551275193691,-0.4934323728084564,0.11106804013252258,-0.1902034729719162,-0.0906832367181778,-0.2882240116596222,0.3488796353340149,-0.2516428530216217,0.259956032037735,0.1681610494852066},{-0.3039686381816864,-0.11996036022901535,-0.2145068645477295,0.17112262547016144,0.5201222896575928,0.5324352383613586,-0.14216192066669464,0.22338567674160004,0.36523157358169556,-0.07164910435676575,-0.14413589239120483,-0.012051991187036037},{-0.20367422699928284,-0.2827787399291992,-0.35585442185401917,0.47748327255249023,-0.42263859510421753,0.18971042335033417,0.06588664650917053,0.34880146384239197,0.4381226599216461,0.35009607672691345,-0.09240495413541794,-0.14166608452796936},{-0.5282863974571228,0.2965376079082489,-0.21900911629199982,0.21967650949954987,0.1974230408668518,0.4253833591938019,-0.24237878620624542,0.2715146839618683,-0.34217825531959534,0.1383345127105713,0.06924176216125488,-0.36769533157348633},{-0.3288877010345459,0.18886014819145203,0.2873450219631195,-0.11981558054685593,0.34569358825683594,-0.22009608149528503,-0.5790343284606934,0.19452163577079773,0.026402270421385765,-0.3180418312549591,0.3059852719306946,-0.15810590982437134},{0.09990043938159943,0.41334033012390137,0.027021417394280434,-0.1171535924077034,-0.2895311713218689,0.19430167973041534,-0.31888699531555176,-0.30978360772132874,0.04491468891501427,-0.10853412747383118,0.3940221965312958,0.33334746956825256},{-0.5166271328926086,-0.40770259499549866,-0.2745548486709595,-0.3875894844532013,-0.32200199365615845,0.40477097034454346,0.10266748070716858,0.2689412534236908,-0.10634883493185043,0.17296938598155975,-0.3030727803707123,0.4517171084880829},{-0.141584575176239,-0.17948392033576965,0.282052218914032,-0.38245850801467896,0.33488184213638306,-0.14764150977134705,-0.12195950746536255,-0.3574327230453491,0.017273949459195137,0.3047935366630554,-0.1401587724685669,-0.18913795053958893},{-0.08177226036787033,-0.2673081159591675,-0.19020552933216095,-0.09710872173309326,0.20609480142593384,-0.2839801013469696,0.3284337520599365,-0.46381279826164246,-0.41116032004356384,-0.25171738862991333,0.06327175348997116,-0.4866078794002533},{-0.49428921937942505,-0.11044429987668991,-0.477258563041687,0.36731716990470886,-0.45642808079719543,-0.15916754305362701,0.044642262160778046,-0.41399383544921875,-0.34505322575569153,0.27300259470939636,-0.47785183787345886,-0.013947819359600544},{-0.42489978671073914,-0.49473434686660767,-0.3043317496776581,0.097933329641819,-0.3084123134613037,0.1383039802312851,0.1681898832321167,0.12822028994560242,0.4019400477409363,0.32104310393333435,0.4352167546749115,-0.08687189966440201}};
float bias1[12] = {-0.09348189830780029,0.0036117220297455788,-0.04622647538781166,-0.0005901068798266351,0.03841051459312439,0.04004323482513428,-0.1001342236995697,0.06574095785617828,0.049853574484586716,0.0037274558562785387,0.031546466052532196,-0.01626460626721382};

float weights2[12][128] = {{0.12232562154531479,-0.08662522584199905,-0.03625666722655296,-0.09707299619913101,-0.008703982457518578,-0.24404528737068176,-0.1022757962346077,-0.22105929255485535,-0.14320571720600128,0.06787227839231491,-0.15324559807777405,0.0794028639793396,0.20146092772483826,0.14601586759090424,-0.12747173011302948,0.15292513370513916,-0.15564993023872375,-0.06880491226911545,-0.10372766852378845,0.16055338084697723,0.16852323710918427,-0.030352074652910233,0.16168589890003204,-0.13217021524906158,0.10593348741531372,0.08081433922052383,-0.06877418607473373,0.10290373861789703,-0.19413571059703827,-0.12320360541343689,0.14443518221378326,-0.08377166837453842,-0.053936298936605453,0.07118488848209381,-0.14815084636211395,-0.1573607474565506,0.20175059139728546,-0.14168377220630646,0.12769585847854614,-0.0933864563703537,-0.17274925112724304,-0.10681477934122086,0.17804740369319916,0.10692685097455978,0.018464110791683197,-0.06802672892808914,-0.08413875102996826,0.12207789719104767,0.16290226578712463,0.009088363498449326,0.15640030801296234,-0.1514015644788742,-0.2537393867969513,-0.057184021919965744,-0.012444164603948593,-0.11223889142274857,-0.14599591493606567,0.02963309921324253,0.1279246062040329,-0.2114172726869583,-0.11279792338609695,-0.10161633044481277,-0.06106119230389595,-0.17741596698760986,0.03369198366999626,0.13437233865261078,-0.07343383133411407,-0.1683817058801651,-0.017251238226890564,0.0019668382592499256,0.031298015266656876,0.02036340907216072,0.18675558269023895,0.2036876529455185,0.19956959784030914,0.05269851163029671,-0.03552525117993355,-0.045686785131692886,0.16248439252376556,-0.03254587575793266,-0.13400661945343018,-0.15645641088485718,0.14996711909770966,0.13419371843338013,-0.07220052927732468,0.07061775773763657,-0.13079191744327545,-0.1772993952035904,-0.18882621824741364,0.0845966711640358,0.03365592285990715,-0.1410461962223053,-0.15809229016304016,0.005815073847770691,-0.17279820144176483,-0.10929957032203674,-0.15612001717090607,-0.02775578200817108,-0.024812405928969383,-0.0731423869729042,-0.05278574302792549,0.13327734172344208,0.120712049305439,-0.06382836401462555,0.18958193063735962,-0.20911243557929993,-0.07676875591278076,0.1608770340681076,0.10640737414360046,-0.23224999010562897,0.07531492412090302,-0.25611135363578796,0.03957260027527809,-0.011916936375200748,0.07400190830230713,-0.14001262187957764,0.1971629112958908,0.1488463133573532,-0.07062722742557526,-0.08598743379116058,0.10781906545162201,-0.017415214329957962,0.09360875189304352,0.15875859558582306,-0.2046418935060501,-0.12446518987417221,-0.1661820411682129,-0.13488146662712097},{0.10609903186559677,0.1050572395324707,-0.16056160628795624,-0.012340988032519817,0.028371378779411316,-0.09847263991832733,-0.13490846753120422,0.09043069183826447,0.04466862976551056,-0.07782314717769623,0.13606463372707367,0.2069210708141327,0.10172172635793686,-0.10112602263689041,0.03737350553274155,-0.18543562293052673,-0.004736819304525852,0.08181442320346832,0.1409158855676651,-0.007940808311104774,0.10526539385318756,0.13020706176757812,0.18651209771633148,-0.1624670922756195,0.1947052776813507,-0.07209954410791397,-0.06466268002986908,0.1620037704706192,0.07965695858001709,0.010818219743669033,0.009572518989443779,0.09304668754339218,-0.13964611291885376,0.13263441622257233,0.061066798865795135,-0.11131365597248077,0.15722157061100006,0.17012418806552887,-0.15045183897018433,-0.14354589581489563,-0.04435340687632561,-0.030777717009186745,-0.07255932688713074,-0.012067781761288643,0.16824303567409515,0.1762208193540573,0.02969047613441944,-0.04209531471133232,0.15110178291797638,0.05399682745337486,0.012744009494781494,0.19607359170913696,-0.03822208195924759,-0.10946419090032578,0.045021604746580124,-0.028353875502943993,0.09893416613340378,-0.19842693209648132,-0.14632880687713623,-0.019907571375370026,0.11203531175851822,-0.04750414565205574,0.12322850525379181,0.03102543205022812,0.016441818326711655,-0.0549909770488739,0.057491954416036606,-0.013520609587430954,-0.03853871300816536,-0.16664205491542816,-0.1987113654613495,-0.12494421750307083,0.09055976569652557,-0.1650683581829071,0.025707587599754333,-0.09292319416999817,-0.05868619680404663,-0.14307323098182678,-0.061394646763801575,0.19080546498298645,-0.08842699229717255,0.1332620233297348,0.08634127676486969,-0.1697426587343216,-0.20098459720611572,0.004649325739592314,-0.0815107449889183,-0.0684443935751915,-0.14641644060611725,0.16391977667808533,0.10238175094127655,-0.06147411838173866,-0.1387374848127365,-0.11984417587518692,-0.18454985320568085,0.08230460435152054,-0.06273938715457916,-0.19404718279838562,-0.19671054184436798,0.09330324083566666,-0.17336693406105042,0.1612190455198288,0.06606964766979218,-0.047565653920173645,0.12128797173500061,0.023381615057587624,-0.10389742255210876,-0.027687689289450645,0.002147427061572671,-0.06846979260444641,-0.15009650588035583,0.14075815677642822,0.07458721846342087,0.1323217898607254,0.18290922045707703,0.11378894746303558,-0.16563788056373596,0.00015014904784038663,0.17523306608200073,0.006892630364745855,-0.14626415073871613,-0.1632920354604721,0.04853533208370209,0.16003230214118958,0.06516921520233154,0.16605855524539948,0.06623002886772156,-0.10559223592281342},{0.034472569823265076,0.18631476163864136,-0.008839019574224949,-0.18322406709194183,-0.17786934971809387,-0.114078089594841,0.05352462828159332,-0.004545317031443119,-0.13794627785682678,-0.08351363986730576,-0.10046631842851639,-0.1605263203382492,0.04448505491018295,0.10889418423175812,-0.07669045031070709,-0.16460710763931274,-0.03516668081283569,-0.1297658085823059,-0.00774799520149827,0.011151234619319439,0.019867513328790665,-0.14356237649917603,-0.16220252215862274,0.018961703404784203,0.1059453934431076,0.004057371057569981,0.056275516748428345,0.06851238012313843,0.12494517862796783,-0.13029251992702484,0.045472174882888794,0.16996070742607117,0.08674748986959457,0.10064281523227692,-0.16652031242847443,0.18468785285949707,-0.032685719430446625,-0.08125019818544388,-0.07026851922273636,-0.12207695096731186,-0.060156889259815216,0.11412527412176132,-0.16665346920490265,0.08629275858402252,-0.14671991765499115,0.10689444839954376,-0.08720651268959045,-0.07405572384595871,-0.16876210272312164,0.14191794395446777,0.08377282321453094,-0.014195667579770088,0.07165179401636124,0.08498352020978928,-0.017778880894184113,-0.17934784293174744,0.03293831646442413,0.10021732747554779,-0.05229976400732994,-0.14883272349834442,0.17431998252868652,0.19127796590328217,-0.03176940232515335,0.1484646201133728,-0.09718155860900879,0.18730448186397552,0.2034061998128891,0.1683717966079712,0.176417738199234,0.17790234088897705,0.14823012053966522,-0.11154650151729584,-0.09274742007255554,0.19647739827632904,-0.14718200266361237,-0.007352401502430439,0.16761820018291473,-0.09719545394182205,0.08724988996982574,0.1231752261519432,-0.17100320756435394,-0.10406667739152908,0.12237446010112762,-0.08256262540817261,0.20718930661678314,0.08785732835531235,-0.0014829355059191585,-0.015388942323625088,-0.048303209245204926,-0.20163260400295258,0.1540270447731018,-0.19078847765922546,-0.0011113021755591035,0.2044767439365387,-0.08364784717559814,0.0517243966460228,-0.051888883113861084,0.08846419304609299,-0.178608700633049,-0.21322686970233917,-0.18596477806568146,-0.01237405277788639,-0.10757658630609512,0.03957238793373108,-0.03670795261859894,-0.10592871904373169,0.09722297638654709,-0.19098950922489166,0.16240143775939941,0.06796659529209137,0.19164037704467773,0.19096212089061737,0.054425012320280075,-0.048301924020051956,-0.16083447635173798,0.007180655840784311,0.17739273607730865,0.051516808569431305,0.005916326306760311,0.08223749697208405,0.20327748358249664,-0.19606514275074005,0.04656021296977997,0.030123770236968994,0.18394875526428223,-0.13136076927185059,0.09510884433984756,0.011086611077189445},{-0.14910651743412018,-0.01916438899934292,0.14005549252033234,0.10369709134101868,-0.14315399527549744,-0.02619428187608719,-0.15896251797676086,0.08824796974658966,-0.0663125291466713,0.14115634560585022,0.04019260033965111,0.1318921148777008,-0.06276535987854004,0.1196020096540451,0.14682389795780182,0.11356601119041443,0.06430763751268387,0.18414348363876343,0.10980980843305588,-0.10401249676942825,-0.01937243342399597,0.18167859315872192,0.13930298388004303,-0.09934248775243759,-0.008067674934864044,-0.025933049619197845,0.04813613370060921,-0.13850465416908264,0.04671008512377739,0.058787811547517776,0.06060900539159775,0.18302473425865173,0.1390053927898407,-0.14745189249515533,-0.08204445987939835,-0.05205617845058441,0.05827954411506653,0.19007623195648193,-0.023391205817461014,-0.011035997420549393,-0.041319865733385086,-0.04260057210922241,-0.028404995799064636,-0.09615238755941391,-0.07758670300245285,-0.09762479364871979,0.011634626425802708,-0.004631660878658295,-0.10132923722267151,0.180544912815094,-0.06978055834770203,-0.06205567717552185,0.1465383768081665,-0.004213929641991854,0.021618425846099854,0.19844689965248108,-0.023115169256925583,0.05201368406414986,-0.03626939654350281,0.11337050795555115,-0.13378320634365082,-0.10602092742919922,-0.030354855582118034,-0.024278549477458,-0.1265437752008438,0.1789245754480362,0.0137028768658638,0.07519949972629547,0.04871714115142822,-0.027697132900357246,-0.07249043136835098,-0.12152183055877686,0.010408580303192139,0.044644251465797424,0.07463323324918747,-0.11444265395402908,0.2091822475194931,0.14324793219566345,-0.10317450016736984,-0.16947011649608612,0.04258110001683235,-0.14720839262008667,0.038084521889686584,-0.04107053577899933,-0.05705048888921738,-0.043992139399051666,0.1966610848903656,0.10542093962430954,0.12803959846496582,0.14599819481372833,0.14710263907909393,-0.14877933263778687,0.08325186371803284,-0.21057835221290588,-0.14687228202819824,-0.10090322047472,-0.15310806035995483,-0.08783742785453796,0.1824919581413269,-0.1499304324388504,-0.10060339421033859,-0.1390044391155243,-0.02262941747903824,0.12922225892543793,-0.1504100114107132,-0.10126873105764389,-0.11046741902828217,0.09393488615751266,-0.0878869891166687,0.07475661486387253,-0.19848378002643585,-0.041350360959768295,-0.058929309248924255,0.1641610562801361,-0.1348170042037964,-0.003265579231083393,0.01900707371532917,-0.17475658655166626,-0.16915884613990784,0.101145900785923,-0.06306268274784088,-0.15254521369934082,-0.14001324772834778,0.0010255184024572372,0.16762973368167877,-0.004424320999532938,0.05587504804134369,-0.17856724560260773},{0.19208325445652008,-0.1929585337638855,-0.1364535093307495,0.02992500178515911,0.0697343498468399,0.1396246999502182,0.12514235079288483,-0.16715607047080994,0.1576414853334427,0.20417733490467072,0.04137176275253296,-0.02468659169971943,0.020401233807206154,-0.18920166790485382,-0.08139581233263016,-0.1684923619031906,-0.184910386800766,-0.16710969805717468,-0.03932885080575943,0.05133417993783951,0.1596534550189972,0.1624620258808136,0.03520609438419342,0.06129683181643486,0.1098562702536583,-0.08843944221735,-0.19526547193527222,-0.12723708152770996,-0.19161203503608704,0.2085534781217575,-0.058479271829128265,-0.06142374500632286,-0.05167900770902634,-0.180884450674057,-0.11910208314657211,0.15772007405757904,-0.1787940114736557,-0.1559171825647354,-0.17768502235412598,0.01879936084151268,-0.12561602890491486,0.16804268956184387,-0.02627350389957428,0.19765587151050568,-0.0017057512886822224,-0.0709201768040657,-0.09070422500371933,0.1299930214881897,0.03292803093791008,-0.020879920572042465,-0.12149594724178314,0.11020722985267639,0.001538458513095975,0.11740558594465256,-0.1866687834262848,0.10361362993717194,0.15835043787956238,-0.17560821771621704,-0.11729998141527176,0.005175660364329815,-0.014368061907589436,-0.1401427686214447,-0.0039069135673344135,-0.08336807042360306,0.08594644069671631,-0.08593615889549255,-0.01836675964295864,0.0008357305778190494,-0.15928615629673004,0.20188888907432556,0.08092021197080612,-0.029605049639940262,-0.203544020652771,0.03713132441043854,1.3500723980541807e-05,0.0358806848526001,-0.19104723632335663,-0.0075491247698664665,0.045852020382881165,-0.11058908700942993,0.15029864013195038,0.1151297464966774,-0.05622561275959015,0.1436091512441635,0.15699225664138794,-0.03268657252192497,0.17512601613998413,0.0457485131919384,-0.12348266690969467,0.01126994751393795,0.005817106459289789,0.22374865412712097,0.054095540195703506,-0.12457138299942017,-0.18380188941955566,-0.08918309956789017,-0.14953789114952087,-0.022067565470933914,0.0008434518822468817,0.03955026715993881,0.1376141458749771,-0.1941261738538742,0.027634410187602043,0.1262718141078949,0.09852060675621033,0.1190296933054924,-0.13446234166622162,0.0936199203133583,0.18905338644981384,0.09213301539421082,0.10951820015907288,0.07664966583251953,-0.022601066157221794,-0.1162608414888382,0.1920415461063385,-0.062198616564273834,-0.19726744294166565,-0.058548703789711,-0.17148888111114502,-0.12680843472480774,-0.10777179151773453,0.0633433386683464,-0.052233874797821045,-0.17930883169174194,0.15046173334121704,0.11581262946128845,-0.019091373309493065,0.04238273203372955},{-0.09098093956708908,-0.02035779505968094,-0.2053600549697876,0.13452944159507751,0.08760729432106018,-0.07404256612062454,-0.07493935525417328,0.035293690860271454,0.09342129528522491,-0.18800237774848938,-0.0453002043068409,-0.11323126405477524,-0.05452701821923256,-0.04523244500160217,-0.11224843561649323,0.18685400485992432,0.09999751299619675,-0.17148786783218384,0.044082701206207275,0.19858045876026154,-0.009990787133574486,0.16854457557201385,-0.13420358300209045,0.06768859922885895,0.04399391636252403,-0.011109991930425167,-0.2027120292186737,0.17698438465595245,0.11693640053272247,0.18042097985744476,0.12013822048902512,-0.10475695878267288,-0.1682012975215912,-0.024962585419416428,-0.15166589617729187,-0.1534622311592102,0.1975439190864563,0.14355385303497314,-0.11352050304412842,0.16611997783184052,-0.09211153537034988,0.1879713237285614,-0.14327551424503326,-0.0347798690199852,0.17934300005435944,-0.1834019273519516,0.019394155591726303,0.1665874421596527,0.09197733551263809,-0.022380050271749496,0.008373469114303589,-0.19176343083381653,0.1164727434515953,-0.020327087491750717,-0.12027611583471298,0.005709911230951548,-0.0743686780333519,-0.17289546132087708,0.142120361328125,-0.13926230370998383,-0.043646473437547684,0.19055277109146118,-0.11396648734807968,-0.09051836282014847,0.1245674416422844,-0.16988354921340942,-0.05014574155211449,-0.014006313867866993,-0.10441246628761292,0.199851393699646,0.12846076488494873,-0.0038795936852693558,-0.12942801415920258,-0.09745299816131592,-0.029349172487854958,-0.0029423399828374386,-0.05739297345280647,-0.09470924735069275,0.057058170437812805,-0.07356564700603485,-0.11322149634361267,-0.11662153899669647,0.0758887380361557,0.08203276991844177,-0.13880828022956848,0.22196628153324127,-0.07847605645656586,0.008048665709793568,0.09331692010164261,0.22826527059078217,0.07018624246120453,0.19368962943553925,0.06983795017004013,-0.06767942011356354,-0.040247950702905655,-0.019331814721226692,0.006919504143297672,0.1412293165922165,0.0523567833006382,0.15849308669567108,-0.10450948029756546,-0.07052544504404068,0.17439939081668854,0.1266159862279892,-0.05923749506473541,0.11546282470226288,-0.1923876851797104,0.056065499782562256,0.11625370383262634,-0.13179342448711395,-0.15017472207546234,0.14102700352668762,-0.02421417087316513,0.031133748590946198,-0.06552405655384064,0.006862552836537361,0.05737568810582161,0.1685798466205597,0.12227266281843185,0.154846653342247,0.06356523931026459,-0.06660041958093643,0.11297114193439484,0.19463451206684113,-0.054478056728839874,-0.010380035266280174,0.15366540849208832,0.024962900206446648},{0.16341710090637207,-0.06602250039577484,0.0778048187494278,0.10117975622415543,-0.14089277386665344,-0.0068763308227062225,-0.1258849799633026,-0.19981032609939575,-0.1854589879512787,0.0991869866847992,0.021369032561779022,0.0690949335694313,0.11110863834619522,-0.05303041636943817,-0.21574829518795013,-0.11799269914627075,-0.06566542387008667,0.14785213768482208,0.1888529360294342,-0.09229075163602829,0.06769885867834091,-0.008558708243072033,0.024343475699424744,0.037540022283792496,-0.19512854516506195,0.10318543016910553,-0.1009887158870697,-0.18594251573085785,0.05861683562397957,-0.1967850774526596,-0.08722028136253357,-0.0635334923863411,0.10751348733901978,-0.20816545188426971,-0.08118584752082825,0.1432046890258789,-0.04446541890501976,-0.15031489729881287,-0.0654834657907486,0.1446475386619568,-0.05812782421708107,0.09631926566362381,-0.07149390876293182,-0.02326144091784954,0.05438019335269928,-0.11184006184339523,-0.03305952996015549,-0.11900214850902557,-0.018882611766457558,-0.1232534795999527,0.20406226813793182,0.12685132026672363,-0.023026524111628532,-0.0955183133482933,0.10696133226156235,0.06192437559366226,-0.04219555854797363,0.046391718089580536,-0.08415777236223221,0.15733955800533295,0.0023507431615144014,-0.13677643239498138,-0.13094718754291534,-0.0772157832980156,0.15193377435207367,-0.015050828456878662,-0.12985284626483917,0.06595848500728607,-0.024357838556170464,-0.19568760693073273,-0.06870376318693161,-0.19063779711723328,0.08777491748332977,-0.00048488378524780273,-0.16041545569896698,-0.08815467357635498,-0.09395583719015121,0.05988369137048721,0.044151559472084045,-0.13268320262432098,0.01773509569466114,0.07865336537361145,-0.113914854824543,-0.08983652293682098,-0.12154007703065872,-0.21243208646774292,0.13759994506835938,-0.13350380957126617,-0.20184354484081268,0.03364948183298111,-0.10128149390220642,-0.23597387969493866,-0.07803357392549515,-0.12849070131778717,-0.16139303147792816,0.14338213205337524,0.016093861311674118,0.18265917897224426,-0.07134965062141418,-0.019708048552274704,0.11661913990974426,-0.10423917323350906,-0.08285525441169739,0.18494531512260437,0.04705112427473068,-0.17445623874664307,0.0889744833111763,0.13969898223876953,0.10089442133903503,-0.19086815416812897,0.11100587248802185,-0.23495076596736908,-0.10768206417560577,-0.1489756554365158,0.012720073573291302,-0.1918746381998062,-0.1338450312614441,0.024678239598870277,-0.0013842108892276883,0.09245271235704422,0.009309589862823486,-0.03301415964961052,0.15326227247714996,0.02524251490831375,0.14198563992977142,-0.1296614557504654,-0.018926428630948067,0.11843133717775345},{-0.024638397619128227,-0.19823619723320007,0.05317926034331322,0.029068006202578545,0.11462274193763733,-0.18807531893253326,-0.10981577634811401,0.08695589751005173,-0.09514909982681274,-0.19376693665981293,0.1462179720401764,0.05545812100172043,-0.13936075568199158,-0.16758504509925842,0.15319377183914185,-0.10762141644954681,-0.0723295584321022,0.16609510779380798,0.17889179289340973,-0.19203166663646698,0.08671006560325623,-0.11818993836641312,0.12444929778575897,-0.043807946145534515,0.16141937673091888,0.19248656928539276,-0.1227227970957756,0.09583695977926254,-0.058617886155843735,0.14584289491176605,-0.029897697269916534,0.08166183531284332,0.06876855343580246,0.16873854398727417,0.10917329788208008,0.05811423063278198,0.07920849323272705,-0.19034115970134735,0.1026245504617691,-0.0018357099033892155,0.13839329779148102,-0.07881344854831696,0.12421979010105133,-0.14358703792095184,-0.10884261131286621,-0.18218395113945007,-0.08238426595926285,-0.1259773075580597,0.032850686460733414,-0.15513427555561066,-0.1652447134256363,0.08364688605070114,-0.045687612146139145,-0.06543190777301788,-0.17626208066940308,-0.1808823049068451,-0.1378428339958191,-0.06373007595539093,-0.11054697632789612,0.0754857063293457,0.08285842090845108,0.12365398555994034,-0.19401152431964874,-0.029556527733802795,-0.09589585661888123,-0.1955777108669281,-0.17519636452198029,0.08200974762439728,0.06678071618080139,0.056470539420843124,0.0991959348320961,-0.023622805252671242,0.05568312108516693,-0.027717694640159607,0.036234986037015915,-0.1252019852399826,-0.07361255586147308,-0.04612536355853081,-0.07905550301074982,-0.18163250386714935,-0.11057750880718231,0.013959423638880253,-0.08921481668949127,0.02634318917989731,0.001648269360885024,0.10659347474575043,0.13498607277870178,0.03656589239835739,0.16176287829875946,0.15610317885875702,0.18031400442123413,0.16865217685699463,0.10379023849964142,-0.05543803051114082,0.1770039051771164,-0.11772437393665314,-0.13617943227291107,0.03539836034178734,0.0832488089799881,-0.11841339617967606,0.18801091611385345,0.011242378503084183,0.12770889699459076,-0.002054534386843443,-0.20466117560863495,0.17053672671318054,0.2071041315793991,-0.18562085926532745,-0.083587147295475,0.20434051752090454,-0.09830678999423981,0.0009451890946365893,-0.05044366791844368,0.1299797147512436,-0.049929652363061905,0.17573001980781555,-0.12285184860229492,-0.16135257482528687,0.11075471341609955,0.08264783769845963,-0.1361655294895172,-0.11711390316486359,0.06262825429439545,0.10518693178892136,-0.01798553206026554,0.11242485791444778,-0.1398659348487854,-0.14302019774913788},{-0.20186550915241241,-0.13067561388015747,-0.057082224637269974,0.10322453826665878,0.08219072222709656,0.17081774771213531,0.12873633205890656,0.11778995394706726,-0.1537897139787674,-0.17515304684638977,0.0825141966342926,-0.00876067765057087,0.09491430222988129,-0.011837512254714966,0.22588275372982025,-0.10568360984325409,-0.002853366080671549,-0.09745091944932938,0.059413231909275055,-0.019830115139484406,-0.06481484323740005,-0.0504821315407753,-0.05257830023765564,-0.1278095841407776,0.1034763976931572,0.06913919746875763,-0.11362311244010925,-0.04059939458966255,0.18163496255874634,0.07668966799974442,0.06857091188430786,0.029376115649938583,-0.006714245770126581,-0.025701012462377548,0.05054984986782074,-0.033286165446043015,-0.0883650854229927,-0.18741342425346375,-0.17833659052848816,0.0239937212318182,0.016878478229045868,0.017893288284540176,0.11101116240024567,-0.0189847219735384,0.03181657940149307,-0.012186961248517036,-0.15142680704593658,0.17672814428806305,-0.12362052500247955,0.11791351437568665,0.15854330360889435,0.012870045378804207,-0.052200354635715485,-0.16983391344547272,-0.0005356678157113492,-0.1119425892829895,0.19819293916225433,-0.018123634159564972,-0.15180674195289612,-0.08584148436784744,-0.10041236132383347,0.10139155387878418,-0.138704314827919,0.05380045622587204,0.024699484929442406,-0.07695148885250092,-0.044101957231760025,-0.07607974112033844,-0.1629021316766739,0.18777726590633392,-0.18145368993282318,0.10637661069631577,0.11022607982158661,0.07305799424648285,0.04979927837848663,0.148569256067276,0.11083079874515533,0.07672001421451569,-0.16257062554359436,-0.07885251194238663,0.15780457854270935,0.05643116310238838,0.08995522558689117,-0.17030586302280426,-0.07277578860521317,0.08648652583360672,0.06560494005680084,-0.14350025355815887,0.17018970847129822,0.1477528214454651,0.15174081921577454,0.19291765987873077,0.16889166831970215,0.06216052547097206,-0.02029051072895527,0.02935032919049263,-0.14154072105884552,-0.19545263051986694,0.03630172088742256,0.11200293153524399,-0.12138418853282928,0.20307902991771698,-0.1523408442735672,-0.17544427514076233,-0.11203990131616592,-0.08017344027757645,0.08235975354909897,0.17217931151390076,0.06000134348869324,-0.11681494861841202,0.12077683955430984,-0.15871736407279968,-0.0797974020242691,0.031969863921403885,0.18922503292560577,0.12629951536655426,-0.2069159299135208,0.023975854739546776,0.15270379185676575,0.03450532257556915,0.004048287868499756,-0.06063969060778618,0.056179121136665344,0.02479470707476139,0.020098641514778137,0.18009483814239502,-0.08499114215373993,-0.12677337229251862},{-0.05454429239034653,0.0915263369679451,-0.011934332549571991,-0.003883049823343754,0.19808785617351532,0.07853727787733078,0.20254018902778625,-0.18007120490074158,-0.17881445586681366,-0.13962885737419128,-0.05407845973968506,0.1330963373184204,0.03188573196530342,0.042004480957984924,-0.1114879921078682,-0.17744137346744537,0.03290875628590584,0.05822274088859558,0.16728410124778748,0.08448171615600586,-0.029020514339208603,0.18973426520824432,0.15036217868328094,0.07015351206064224,0.012419437058269978,-0.0793011412024498,0.06030690670013428,0.02859945222735405,-0.0390528067946434,-0.008554823696613312,-0.1730688065290451,-0.17065228521823883,0.053558122366666794,0.013825747184455395,-0.1663123518228531,0.007016348652541637,0.12083444744348526,-0.05392530933022499,-0.05110258236527443,0.1914372593164444,-0.045649122446775436,-0.004570095334202051,0.027166128158569336,0.11719328910112381,0.15506626665592194,-0.10668127983808517,0.1802336424589157,0.14582808315753937,-0.20388874411582947,-0.138898104429245,0.1639748066663742,-0.1447180062532425,-0.013219986110925674,0.14893698692321777,0.10992370545864105,0.20347897708415985,-0.0625048354268074,0.0007722381269559264,0.07053215056657791,0.03858278691768646,-0.07862275838851929,-0.03606565296649933,-0.07834727317094803,0.06245167553424835,0.18834489583969116,0.13599015772342682,-0.024033308029174805,0.1833646148443222,-0.18151989579200745,-0.1533527374267578,-0.12885890901088715,-0.17230330407619476,-0.18095549941062927,0.09549058973789215,-0.14100928604602814,-0.1941298097372055,0.029846185818314552,-0.13918885588645935,0.028943240642547607,-0.05088174343109131,0.06689706444740295,-0.08066687732934952,0.044221267104148865,0.05127280578017235,-0.07884842902421951,0.10793486982584,-0.05016511678695679,0.12831978499889374,-0.0909678041934967,0.1322694569826126,-0.1377985030412674,0.1324051469564438,0.08905971795320511,0.08231612294912338,-0.15527528524398804,0.058812517672777176,0.14599135518074036,-0.09157279878854752,0.06770171970129013,0.1305062174797058,-0.10389880836009979,0.025415144860744476,-0.10831423103809357,0.04389086738228798,-0.10989849269390106,-0.20445768535137177,-0.15104804933071136,-0.15676984190940857,0.0845027044415474,-0.19853240251541138,0.18985912203788757,-0.1717800796031952,-0.03429253771901131,0.1738368272781372,0.05117641016840935,-0.1597043126821518,0.06175055354833603,0.14730004966259003,0.19593261182308197,-0.002469494938850403,0.17639358341693878,-0.18739788234233856,0.1935526579618454,0.048583466559648514,-0.11319299787282944,-0.04626215994358063,-0.05397453159093857,0.13003453612327576},{-0.09968733787536621,-0.13641996681690216,0.0377327986061573,-0.1688302606344223,0.12218723446130753,0.16769343614578247,-0.04009978473186493,0.15340125560760498,-0.09159649908542633,0.074917271733284,0.08254708349704742,0.06519998610019684,0.06913938373327255,-0.06844969093799591,0.09080569446086884,0.09816252440214157,0.09395239502191544,-0.017817024141550064,0.1562766432762146,0.015819299966096878,-0.17017298936843872,0.004382489249110222,0.014320433139801025,-0.05838632583618164,-0.08515800535678864,-0.08856407552957535,0.12665292620658875,-0.09421351552009583,0.016666149720549583,0.07089641690254211,-0.02382996305823326,0.17884331941604614,-0.15352723002433777,0.060024164617061615,-0.004950509872287512,0.0555851086974144,-0.053562093526124954,-0.08137211948633194,0.1246698647737503,0.07339386641979218,-0.0687282532453537,-0.07235579937696457,-0.1996733695268631,0.07262475043535233,0.01888762041926384,-0.11793474853038788,0.18891917169094086,-0.14295387268066406,0.1495504081249237,-0.13825447857379913,-0.1979473978281021,0.12299221009016037,-0.13165396451950073,0.06427934765815735,-0.02854091115295887,-0.14012476801872253,0.12555117905139923,0.03573385253548622,-0.06769072264432907,0.06322606652975082,0.184881791472435,0.18580599129199982,0.2127505987882614,0.0031818703282624483,-0.00661678658798337,-0.09405825287103653,-0.10988911241292953,0.185319721698761,-0.046852607280015945,-0.10443088412284851,0.12644973397254944,0.20673784613609314,-0.13128286600112915,0.16466693580150604,0.01946009323000908,-0.04274356737732887,0.1369977742433548,-0.026273932307958603,-0.1626165807247162,-0.1872168928384781,0.03293337672948837,0.09059727191925049,-0.06491126120090485,0.13111278414726257,-0.04107700660824776,-0.07027968764305115,0.13617517054080963,0.04449106380343437,0.12912796437740326,0.15142232179641724,-0.16682101786136627,0.06048698350787163,-0.06677786260843277,-0.06504694372415543,0.11277453601360321,0.004013723228126764,0.03724992647767067,0.09205910563468933,0.20135214924812317,0.09952550381422043,-0.0013096703914925456,0.09134472906589508,0.012451332993805408,0.15406584739685059,-0.02301977016031742,0.08758395910263062,-0.077325738966465,-0.06748594343662262,-0.15368522703647614,-0.020357541739940643,0.04881400987505913,-0.07369057834148407,-0.20176531374454498,-0.10626240074634552,-0.10544634610414505,-0.10763146728277206,0.1813202053308487,0.08711915463209152,-0.1086149588227272,-0.12411358952522278,-0.10292677581310272,0.2006586343050003,-0.07484477758407593,0.07319045066833496,0.05608408898115158,0.009729603305459023,-0.1647704392671585,0.014750623144209385},{-0.14414003491401672,0.059956442564725876,0.15711982548236847,0.016506260260939598,0.17988602817058563,-0.210357666015625,-0.13255058228969574,-0.10700895637273788,0.10148415714502335,-0.11344078183174133,-0.07777862250804901,-0.20211291313171387,-0.026248818263411522,0.05048869550228119,-0.12607602775096893,-0.08049134910106659,-0.0717659741640091,0.158514142036438,0.04868456348776817,-0.11268489062786102,0.1898464411497116,0.03485832363367081,-0.031906500458717346,0.13391229510307312,-0.028756873682141304,-0.17960765957832336,0.18950839340686798,0.17567762732505798,0.1586761623620987,0.06101939454674721,-0.04567622393369675,-0.09087042510509491,-0.2025585174560547,0.001084009069018066,0.07710244506597519,0.17378251254558563,-0.13676884770393372,0.013539750128984451,-0.1588466316461563,-0.21348515152931213,-0.13761422038078308,-0.10876449942588806,0.13393492996692657,-0.07405985891819,-0.03274082392454147,-0.01207923237234354,0.13639695942401886,-0.17767536640167236,-0.027121493592858315,-0.02455342933535576,-0.02252279222011566,0.16300807893276215,-0.06857724487781525,0.19200007617473602,-0.04670444503426552,-0.05908752977848053,-0.1910262107849121,-0.02182227186858654,-0.20218545198440552,0.10133112967014313,0.06163720786571503,-0.18513470888137817,-0.03470504283905029,0.12610962986946106,-0.08435170352458954,-0.07163195312023163,0.056642528623342514,-0.07641439884901047,-0.05530500411987305,0.14070147275924683,0.20318472385406494,0.07928894460201263,-0.14294105768203735,-0.11969805508852005,0.04430936649441719,0.0726299062371254,-0.034544702619314194,0.13270965218544006,0.131317600607872,0.2067035734653473,0.06582561880350113,-0.18320301175117493,-0.027705207467079163,0.13727635145187378,0.028913332149386406,-0.047104768455028534,-0.1361406147480011,-0.12468233704566956,0.17424286901950836,0.10983419418334961,0.04529648646712303,-0.018111467361450195,0.08446476608514786,0.0964391678571701,-0.049435630440711975,0.16500088572502136,-0.023018794134259224,-0.13475501537322998,-0.17623452842235565,-0.00920962542295456,-0.008672758005559444,0.03995957970619202,-0.20250633358955383,-0.016662167385220528,-0.004574373364448547,0.14862200617790222,0.07859344035387039,-0.016357729211449623,0.13591201603412628,0.0972503051161766,0.09683994203805923,0.014025386422872543,0.1736515760421753,0.1729578673839569,-0.07402483373880386,0.20123198628425598,-0.0004443081852514297,0.2046394944190979,-0.06622829288244247,0.030636539682745934,-0.1095462366938591,0.1828252375125885,-0.01231752336025238,-0.008607677184045315,0.12434671074151993,-0.11018450558185577,-0.11680857092142105,-0.19009728729724884}};
float bias2[128] = {6.758357358194189e-06,6.1529722188424785e-06,5.2808541113336105e-06,-7.648211976629682e-06,-4.365927566141181e-07,-5.976758984616026e-06,1.9833698843285674e-06,6.396407457032183e-07,-9.142656381300185e-06,-7.156146693887422e-06,7.997390639502555e-06,-5.941742529103067e-06,5.02193233842263e-06,0.0,-3.6038543385075172e-06,-8.453240525341243e-07,7.525427463406231e-06,-2.014717637166541e-07,4.900951353192795e-06,1.912287643790478e-06,5.978532044537133e-06,1.6580727333348477e-06,0.0,4.983947292203084e-06,-4.54262499260949e-06,9.37728657390835e-07,4.422084657562664e-06,-2.1544947230722755e-06,-4.097437340533361e-06,-9.248416063201148e-06,3.6561036722559948e-06,-6.5558788264752366e-06,-3.37356686941348e-06,-9.109664460993372e-06,7.140975412767148e-06,-6.8280046434665564e-06,8.208766303141601e-06,-5.022636287321802e-06,9.96997914626263e-06,-4.676652679336257e-06,3.51494941241981e-06,-7.019251825113315e-06,0.0,-5.632580723613501e-06,-5.519933438336011e-06,-9.625852726458106e-06,3.0366149417204724e-07,-6.188344059410156e-07,-9.150554433290381e-06,7.959234608279075e-06,0.0,-6.092437274674012e-07,-3.7168460949033033e-06,6.312986897683004e-07,-4.658069883589633e-06,-3.1468023280467605e-06,8.462787263852078e-06,-1.3906969797972124e-06,-8.598707609053236e-06,-7.192142561507353e-07,-2.2810202153777936e-06,1.0002911949413829e-05,2.2298411295196274e-07,-5.774554665549658e-06,-4.847489435633179e-06,0.0,-9.137876077147666e-06,-3.1948352443578187e-06,3.831896719930228e-06,7.422374892485095e-06,-5.349679668142926e-06,-9.929133739206009e-06,0.0,0.0,2.8921417651872616e-06,-9.955093446478713e-06,1.503998078078439e-06,-6.597465471713804e-06,0.0,-8.230522325902712e-06,-5.38183576281881e-06,7.515114248235477e-06,0.0,9.89341515378328e-07,8.318824257003143e-06,-4.467564849619521e-06,6.741844117641449e-06,-2.1666780867235502e-06,-1.905158057979861e-07,-9.151820449915249e-06,-5.566949312196812e-06,-4.067253485118272e-06,8.476029506709892e-06,2.2692952370562125e-06,6.265761385293445e-06,-8.365519192921056e-07,-9.78144453256391e-06,5.105171112518292e-07,-3.864219593197049e-07,3.7882837204961106e-06,5.245037755230442e-07,2.726248112594476e-06,-7.335351256188005e-06,1.2407481335685588e-06,-7.797936632414348e-06,6.786339781683637e-06,7.406543318211334e-06,-8.3938521129312e-06,7.440561148541747e-06,-2.0683687580458354e-06,8.251190593000501e-06,1.3920486026108847e-06,3.1450822461920325e-06,-9.104247510549612e-06,-5.7648726397019345e-06,5.222515937930439e-06,4.277540028851945e-06,-8.813828571874183e-06,6.9129132498346735e-06,-5.4495499171025585e-06,0.0,-7.084553544700611e-06,0.0,-6.844052791166177e-07,-8.584112038079184e-06,-3.5569537431001663e-06,-5.043930741521763e-06,3.1611582471668953e-06};

float bias3[64] = {-0.0014087697491049767,0.00545731745660305,0.0050215651281178,-5.598778079729527e-05,0.00692790700122714,0.0010198046220466495,0.00315875094383955,-8.722096026758663e-06,0.007345730438828468,0.0064885495230555534,0.0036258867476135492,0.009433796629309654,-0.0005497832898981869,-0.001637780456803739,0.0011867759749293327,1.0258602856083598e-08,-4.520056245382875e-05,-0.00010914212180068716,0.0,0.0,-0.0020037477370351553,0.006729864049702883,0.006519147660583258,0.008269221521914005,-0.0034008233342319727,-2.135966860805638e-05,-0.0031009658705443144,0.001057044486515224,0.0011088571045547724,-0.0011771888239309192,0.0,0.003623546799644828,1.311404957959894e-07,-0.002248499309644103,-0.00038546326686628163,0.0,-0.0002549355267547071,8.89692785221996e-07,0.0,-0.0008055004291236401,0.004091029521077871,0.006849598605185747,-0.002465758705511689,0.0,-0.0023106588050723076,0.0,0.0,0.0006662565865553916,0.0,-0.00010968268179567531,-0.0015107456129044294,2.1142651007721724e-07,-2.1708133317588363e-06,0.0022890605032444,0.008302812464535236,4.1006627725437284e-05,0.0,-0.0024347533471882343,0.0024306736886501312,-0.0002703388163354248,-0.00037509846151806414,-0.0013007363304495811,0.004489819519221783,0.0010591221507638693};

float weights4[64][1] ={{0.05498412624001503},{-0.258425772190094},{-0.23114268481731415},{0.10542245954275131},{-0.3325980603694916},{-0.06937221437692642},{-0.16768212616443634},{0.011471817269921303},{-0.3597215414047241},{-0.297573447227478},{-0.18310923874378204},{-0.4459899365901947},{0.021449504420161247},{0.061458636075258255},{-0.08810419589281082},{-0.060272686183452606},{0.08506365865468979},{-0.024965813383460045},{-0.0005722641944885254},{-0.21398630738258362},{0.03583347052335739},{-0.31938549876213074},{-0.30113181471824646},{-0.3892625570297241},{0.22097723186016083},{0.19182221591472626},{0.20674802362918854},{-0.058617785573005676},{-0.21537016332149506},{0.032390329986810684},{-0.19628530740737915},{-0.1666991263628006},{-0.260084331035614},{0.10301651805639267},{0.00714214937761426},{0.04618358612060547},{0.09330225735902786},{-0.0223599374294281},{-0.08218370378017426},{0.26625847816467285},{-0.18940478563308716},{-0.33875423669815063},{0.2604355216026306},{0.236935555934906},{0.0804564505815506},{-0.11522167921066284},{-0.28780892491340637},{-0.039388108998537064},{0.12475675344467163},{0.2834143340587616},{0.023737605661153793},{-0.1823592483997345},{0.004706158768385649},{-0.14042451977729797},{-0.39330795407295227},{-0.031130852177739143},{-0.10215502977371216},{0.27130284905433655},{-0.13232219219207764},{0.0919913575053215},{-0.009171749465167522},{0.25825342535972595},{-0.20323753356933594},{-0.067405104637146}};
float bias4[1] = {-0.21494202315807343};


uniform int totalFragments;
uniform int reservedFragments;
 
void storeImportance(float val){imageStore(image_importance, ivec2(gl_FragCoord.xy),     vec4(val,0f,0f,0f));}


float sigmoid(float x){
	return 1.0f / (1.0f + exp(-x));
}

float relu(float x){
	return max(0.0f,x);
}

void main()
{
    	
	uint pixelTotalLayers = imageLoad(image_counter,ivec2(gl_FragCoord.xy)).r;

	if (pixelTotalLayers == 0U) 
	{
        	discard;
		return;
	}
	
	//Load input features
    	float fragmentsToTotalFragments = float(pixelTotalLayers)/float(totalFragments);
    	float reservedPercentage = float(reservedFragments)/float(totalFragments);

    	vec4 zFeatures = imageLoad(zMinMax,ivec2(gl_FragCoord.xy));
    	vec4 zFeaturesAvg = imageLoad(featureTex,ivec2(gl_FragCoord.xy));
    	vec4 zFeaturesNearest = unpackUnorm4x8(uint(imageLoad(nearest_featureTex,ivec2(gl_FragCoord.xy)).r));

	float input[1][12] = {{fragmentsToTotalFragments,reservedPercentage,zFeatures.r,zFeatures.g,zFeatures.b,zFeatures.a,zFeaturesAvg.r,zFeaturesAvg.g,zFeaturesAvg.b,zFeaturesNearest.r,zFeaturesNearest.g,zFeaturesNearest.b}};

	//Get NN output (importance)	

    	float rslt[128];
 
    	int R1 = 1;
    	int C1 = 12;
    	int R2 = 12;
    	int C2 = 12;
    
        for (int j = 0; j < C2; j++) {
        	rslt[j] = 0;
            	for (int k = 0; k < R2; k++) {
                	rslt[j] += input[i][k] * weights1[k][j];
		}
		rslt[j] = rslt[j] + bias1[j];
	}   
    
    	float rslt2[128];
    
    	R1 = 1;
    	C1 = 12;
    	R2 = 12;
    	C2 = 128;

    
        for (int j = 0; j < C2; j++) {
            	rslt2[j] = 0;
            	for (int k = 0; k < R2; k++) {
                	rslt2[j] += rslt[k] * weights2[k][j];
            	}
		rslt2[j] = relu(rslt2[j] + bias2[j]);
	}

	R1 = 1;
    	C1 = 128;
    	R2 = 128;
    	C2 = 64;
   
        for (int j = 0; j < C2; j++) {
            	rslt[j] = 0;
            	for (int k = 0; k < R2; k++) {
                	int index = k*64 + j;
                	rslt[j] += weights[index]*rslt2[k];
            	}
            	rslt[j] = relu(z + bias3[j]);
        }

    
    	R1 = 1;
    	C1 = 64;
    	R2 = 64;
    	C2 = 1;
    
        for (int j = 0; j < C2; j++) {
            	rslt2[j] = 0;
            	for (int k = 0; k < R2; k++) {
                	rslt2[j] += rslt[k] * weights4[k][j];
            	}
            	rslt2[j] = sigmoid(rslt2[j] + bias4[j]);
        } 

    	float imp = rslt2[0];
    	float total_importance = max(0,imp);
	float scalar = 1000.0;
	float importance = clamp(total_importance, 0.01, 1.0) ;
	
	uint int_importance = uint(floor(importance*scalar+0.5));
	
	storeImportance(importance);
	for (int i = 0; i < int_importance && i < int(scalar); ++i){
		atomicCounterIncrement(total_counter);	
	}

    	//clear feature texes
    	imageStore(zMinMax,ivec2(gl_FragCoord.xy),vec4(0.0f));
    	imageStore(featureTex,ivec2(gl_FragCoord.xy),vec4(0.0f));

}
